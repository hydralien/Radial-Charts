(function(t){function e(e){for(var a,c,s=e[0],o=e[1],h=e[2],u=0,f=[];u<s.length;u++)c=s[u],Object.prototype.hasOwnProperty.call(n,c)&&n[c]&&f.push(n[c][0]),n[c]=0;for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a]);l&&l(e);while(f.length)f.shift()();return i.push.apply(i,h||[]),r()}function r(){for(var t,e=0;e<i.length;e++){for(var r=i[e],a=!0,c=1;c<r.length;c++){var o=r[c];0!==n[o]&&(a=!1)}a&&(i.splice(e--,1),t=s(s.s=r[0]))}return t}var a={},n={app:0},i=[];function c(t){return s.p+"js/"+({canvg:"canvg",pdfmake:"pdfmake"}[t]||t)+"."+{canvg:"b693b3d4",pdfmake:"c4230492"}[t]+".js"}function s(e){if(a[e])return a[e].exports;var r=a[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.e=function(t){var e=[],r=n[t];if(0!==r)if(r)e.push(r[2]);else{var a=new Promise((function(e,a){r=n[t]=[e,a]}));e.push(r[2]=a);var i,o=document.createElement("script");o.charset="utf-8",o.timeout=120,s.nc&&o.setAttribute("nonce",s.nc),o.src=c(t);var h=new Error;i=function(e){o.onerror=o.onload=null,clearTimeout(u);var r=n[t];if(0!==r){if(r){var a=e&&("load"===e.type?"missing":e.type),i=e&&e.target&&e.target.src;h.message="Loading chunk "+t+" failed.\n("+a+": "+i+")",h.name="ChunkLoadError",h.type=a,h.request=i,r[1](h)}n[t]=void 0}};var u=setTimeout((function(){i({type:"timeout",target:o})}),12e4);o.onerror=o.onload=i,document.head.appendChild(o)}return Promise.all(e)},s.m=t,s.c=a,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(r,a,function(e){return t[e]}.bind(null,a));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s.oe=function(t){throw console.error(t),t};var o=window["webpackJsonp"]=window["webpackJsonp"]||[],h=o.push.bind(o);o.push=e,o=o.slice();for(var u=0;u<o.length;u++)e(o[u]);var l=h;i.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("56d7")},"034f":function(t,e,r){"use strict";var a=r("85ec"),n=r.n(a);n.a},1:function(t,e){},2:function(t,e){},"56d7":function(t,e,r){"use strict";r.r(e);r("e260"),r("e6cfa"),r("cca6"),r("a79d");var a=r("2b0e"),n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"app"}},[r("Tabs",{on:{changed:t.chartSourceChange}},[r("Tab",{attrs:{name:"Data URLs",id:t.chartSources.URL}},[r("div",{attrs:{id:"urls-alert"}},[r("p",[t._v("Use {referenceDate} in the URL to replace it with the selected date (if required)")])]),t._l(t.chartUrls,(function(e,a){return r("div",{key:a},[r("label",[t._v("Metric URL: "),r("input",{directives:[{name:"model",rawName:"v-model.lazy",value:e.chartUrl,expression:"chart.chartUrl",modifiers:{lazy:!0}}],staticClass:"chart-url",domProps:{value:e.chartUrl},on:{change:function(r){return t.$set(e,"chartUrl",r.target.value)}}})]),r("button",{on:{click:function(e){return t.deleteUrl(a)}}},[t._v("delete")])])}))],2)],1),r("label",[t._v("Reference date: "),r("Datepicker",{attrs:{id:"referenceDate","monday-first":!0},model:{value:t.referenceDate,callback:function(e){t.referenceDate=e},expression:"referenceDate"}})],1),r("CircularChart",{attrs:{"chart-list":t.chartList,"chart-urls":t.chartUrls,"reference-date":t.referenceDate,"chart-source":t.chartSource}})],1)},i=[],c=(r("4160"),r("a434"),r("ac1f"),r("5319"),r("159b"),r("53ca")),s=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"chart-container"},[t.reloading?r("div",{attrs:{id:"loading"}},[t._v("...LOADING...")]):t._e(),r("div",{staticClass:"chart-container",attrs:{id:"amChart"}})])},o=[],h=(r("cb29"),r("b0c0"),r("b64b"),r("d3b7"),r("2ca0"),r("71c9")),u=r("c497"),l=r("5a54"),f=r("86ec"),d={GRAPHITE:"chart-source-graphite",URL:"chart-source-url"};h["b"](l["a"]);var p={name:"CircularChart",data:function(){return{mergedMetrics:{},reloading:!1,reloadingProcess:Promise.resolve(),mergedChartInfo:[]}},props:{chartList:[Object,Array],chartUrls:[Object,Array],referenceDate:Date,chartSource:String},mounted:function(){this.chartDataMerge()},watch:{chartDetails:{deep:!0,handler:function(){this.drawChart()}},referenceDate:function(){this.chartDataMerge()},chartList:{deep:!0,handler:function(){this.chartDataMerge()}},chartUrls:{deep:!0,handler:function(){this.chartDataMerge()}},chartSource:function(){this.chartDataMerge()}},methods:{transformMergedData:function(){var t=this,e=[];return Object.keys(this.$data.mergedMetrics).forEach((function(r){if(!r.startsWith("__")){var a={date:new Date(r)};e.push(Object.assign(a,t.$data.mergedMetrics[r]))}})),e},drawChart:function(){var t=h["a"](this.$el.getElementsByClassName("chart-container")[0],u["b"]);t.data=this.transformMergedData();var e=t.xAxes.push(new u["a"]);e.dataFields.category="date",e.tooltip.disabled=!1,e.groupData=!0,e.periodChangeDateFormats.setKey("day","yyyy");var r=t.yAxes.push(new u["e"]);r.renderer.axisFills.template.fill=t.colors.getIndex(2),r.renderer.axisFills.template.fillOpacity=.05,r.tooltip.disabled=!0,this.$data.mergedChartInfo.forEach((function(e){if(!e.isEmpty()){var r="value"+e.index,a=t.series.push(new u["d"]);a.dataFields.valueY=r,a.groupFields.valueY="sum",a.dataFields.dateX="date",a.name="Chart "+r,a.strokeWidth=3,a.tooltipText=e.hintText(),a.tooltip.disabled=!1,a.fillOpacity=.3}})),t.cursor=new u["c"],this.chart=t},chartDisposal:function(){this.chart&&this.chart.dispose()},appendArray:function(t,e){var r=this;this.$data.mergedChartInfo.push(e);var a=this.$data.mergedMetrics,n=e.index,i="value"+n,c=new Date;t.forEach((function(t){var e=t[t.length-2];if(r.chartSource===d.URL){var n=new Date(e);n.setFullYear(c.getFullYear()),n.setMonth(c.getMonth()),n.setDate(c.getDate()),n.setMinutes(5*parseInt(n.getMinutes()/5)),n.setSeconds(0),e=n.toISOString()}var s=t[t.length-1];a[e]||(a[e]={}),a[e][i]=a[e][i]?a[e][i]+parseFloat(s):parseFloat(s)}))},chartDataMerge:function(){var t=this,e=[];if(!this.reloading){this.$data.reloading=!0,this.$data.mergedMetrics={},this.$data.mergedChartInfo=[];var r=this.$http,a=0,n=this.chartSource===d.URL?this.chartUrls:this.chartList;n.forEach((function(n){a+=1;var i=n.metricUrl(t.referenceDate);if(i){var c=function(t){var e=this;return r.get(i).then((function(r){var a=f(r.data,{skip_empty_lines:!0,columns:!1});e.appendArray(a,t)})).catch((function(t){return console.error(t)}))}.bind(t),s=Object.assign(n);s.index=a,e.push(c(s))}})),this.reloadingProcess=this.$http.all(e).then((function(){t.$data.reloading=!1,t.drawChart()}))}},beforeDestroy:function(){this.chartDisposal()}}},v=p,g=(r("ea80"),r("2877")),y=Object(g["a"])(v,s,o,!1,null,"19edb99a",null),b=y.exports,m=r("fa33"),D=r("7923"),_=(r("99af"),r("fb6a"),r("d4ec")),w=r("bee2"),$=r("99de"),x=r("262e"),j=r("2caf"),O=function(){function t(){Object(_["a"])(this,t),this._index=0}return Object(w["a"])(t,[{key:"hintText",value:function(){var t=this.index,e=this.shiftHint;return"metric ".concat(t).concat(e,": {valueY}")}},{key:"isEmpty",value:function(){return!0}},{key:"metricUrl",value:function(t){return""}},{key:"index",get:function(){return this._index}},{key:"shiftHint",get:function(){return""}}]),t}(),U=function(t){Object(x["a"])(r,t);var e=Object(j["a"])(r);function r(t,a,n){var i;return Object(_["a"])(this,r),i=e.call(this),"object"===Object(c["a"])(t)?(i._chart=t.chart,i._shift=t.shift,i._index=t.index,Object($["a"])(i)):(i._chart=t,i._shift=a,i._index=n,i)}return Object(w["a"])(r,[{key:"isEmpty",value:function(){return!this.chart}},{key:"metricUrl",value:function(t){if(this.isEmpty())return"";var e="0".concat(t.getMonth()+1).slice(-2),a="0".concat(t.getDate()).slice(-2),n=t.getFullYear(),i=new Date(t.valueOf());i.setDate(i.getDate()+1);var c="0".concat(i.getMonth()+1).slice(-2),s="0".concat(i.getDate()).slice(-2),o=i.getFullYear(),h=parseInt(1e8*Math.random()),u=this.chart;this.shift&&(u="timeShift(".concat(u,"%2C%22").concat(this.shift,"%22)"));var l="".concat(r.GRAPHITE_SITE(),"/render?")+"from=000000_".concat(n).concat(e).concat(a,"&until=000000_").concat(o).concat(c).concat(s)+"&target=".concat(u,"&format=csv")+"&rnd=".concat(h);return l}},{key:"chart",get:function(){return this._chart},set:function(t){this._chart=t}},{key:"shift",get:function(){return this._shift},set:function(t){this._shift=t}},{key:"index",get:function(){return this._index},set:function(t){this._index=t}},{key:"shiftHint",get:function(){return this.shift?" (timeShift ".concat(this.shift,")"):""}}],[{key:"GRAPHITE_SITE",value:function(){return""}}]),r}(O),k=(r("caad"),r("2532"),function(t){Object(x["a"])(r,t);var e=Object(j["a"])(r);function r(t,a){var n;return Object(_["a"])(this,r),n=e.call(this),"object"===Object(c["a"])(t)?(n._url=t.url,n._index=t.index,Object($["a"])(n)):(n._url=t,n._index=a,n)}return Object(w["a"])(r,[{key:"isEmpty",value:function(){return!this.url}},{key:"metricUrl",value:function(t){if(this.isEmpty())return"";var e=this.url,r="{referenceDate}";return e.includes(r)&&e.replace(r,t.toDateString()),e}},{key:"url",get:function(){return this._url},set:function(t){this._url=t}},{key:"index",get:function(){return this._index},set:function(t){this._index=t}},{key:"chartUrl",get:function(){return this._url},set:function(t){this._url=t}}]),r}(O)),S={name:"App",data:function(){return{chartList:[],referenceDate:new Date,chartUrls:[],chartSource:d.URL,chartSources:d,graphiteUrlAvailable:U.GRAPHITE_SITE()}},components:{Tabs:D["Tabs"],Tab:D["Tab"],Datepicker:m["a"],CircularChart:b},watch:{chartList:{deep:!0,handler:function(){this.refreshQueryString(),this.$data.chartList[this.$data.chartList.length-1].chart&&this.$data.chartList.push(new U)}},chartUrls:{deep:!0,handler:function(){this.refreshQueryString(),this.chartUrls[this.chartUrls.length-1].chartUrl&&this.chartUrls.push(new k)}},referenceDate:function(){this.refreshQueryString()}},methods:{chartSourceChange:function(t){this.chartSource=t.tab.id,console.log(this.chartSource)},refreshQueryString:function(){var t=this.$data.referenceDate.toDateString();t===(new Date).toDateString()&&(t="today");var e={refdate:t,chart:[],shift:[],charturl:[]};this.$data.chartList.forEach((function(t){t.chart&&(e.chart.push(t.chart),e.shift.push(t.shift))})),this.chartUrls.forEach((function(t){t.chartUrl&&e.charturl.push(t.chartUrl)})),this.$router.replace({query:e}).catch((function(){}))},deleteChart:function(t){this.chartList.splice(t,1)},deleteUrl:function(t){this.chartUrls.splice(t,1)}},created:function(){if(this.$route.query.refdate&&("today"===this.$route.query.refdate?this.$data.referenceDate=new Date:this.$data.referenceDate=new Date(this.$route.query.refdate)),this.$route.query.chart){for(var t=[],e="object"===Object(c["a"])(this.$route.query.chart)?this.$route.query.chart:[this.$route.query.chart],r="object"===Object(c["a"])(this.$route.query.shift)?this.$route.query.shift:[this.$route.query.shift],a=0;a<e.length;a++){var n=new U(e[a],this.$route.query.shift?r[a]:"");t.push(n)}this.$data.chartList=t}if(this.$route.query.charturl){var i=[],s="object"===Object(c["a"])(this.$route.query.charturl)?this.$route.query.charturl:[this.$route.query.charturl];s.forEach((function(t){var e=new k(t);i.push(e)})),this.chartUrls=i}if(0===this.$data.chartList.length){var o=new U("","");this.$data.chartList=[o,new U]}if(0===this.chartUrls.length){var h=new k("./render.csv");this.chartUrls.push(h,new k)}}},C=S,E=(r("034f"),Object(g["a"])(C,n,i,!1,null,null,null)),L=E.exports,M=r("bc3a"),T=r.n(M),q=r("a7fe"),P=r.n(q),I=r("8c4f");a["a"].use(P.a,T.a),a["a"].config.productionTip=!1;var A=new I["a"]({mode:"history",routes:[]});a["a"].use(I["a"],A),new a["a"]({router:A,render:function(t){return t(L)}}).$mount("#app")},"5f5c":function(t,e){t.exports=xlsx},"85ec":function(t,e,r){},"917a":function(t,e,r){},ea80:function(t,e,r){"use strict";var a=r("917a"),n=r.n(a);n.a}});
//# sourceMappingURL=app.68bc799b.js.map